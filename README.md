
# Call Chains

## Oracle PL/SQL solutions to find table INSERT or UPDATE commands and their call trees

### Why?

Because I needed it when I had to reverse-engineer and investigate a new system.

### How?

These tools just give some help, but they are not 100% exact, becasue they does not handle neither synonyms, nor wrapped codes for example. They can not manage strange codes, for example if every command is in the 1st line or if a command was generated by other comamnds etc.

Despite of these, I think they are useful!

Try, adjust and tune them if necessary.   
**Good luck!**



## GET_PROCEDURE

This is a subroutine to get the name of the (container) procedure or function of a certain line number within a package body.
If the line number is between two procedure/function, it gives back the (upwards) nearest one.  
This is not 100% exact either. But it is called from other procedures, so the line number is valid and is inside a procedure/function block in those cases.

    function GET_PROCEDURE ( I_PACKAGE_NAME    in varchar
                           , I_LINE_NUMBER     in number 
                           , I_OWNER           in varchar default null -- schema owner of the package, if it was important
                           ) return varchar




## PROC_CALL_CHAIN

This recursive procedure tries to crawl the call trees of a given procedure or function. Not easy and not exact to find these references.  
Yes, it could be aided by the ALL_DEPENDENCIES view, but it does not help too much.

    procedure PROC_CALL_CHAIN ( I_NAME            in varchar
                              , I_LEVEL           in integer default 0
                              , I_OWNER           in varchar default null
                              )

If it found a new call reference, it writes that out to dbms output.  

Sample: (level, type of caller, name of caller, line number )

    PROCEDURE | ADD_TRACELOG : 6
    -1: PROCEDURE | ADD_DEBUG : 4
    -1: PROCEDURE | ADD_ERROR : 4
    --2: PROCEDURE | RAISE_EXCEPTION : 21
    -1: PROCEDURE | ADD_WARNING : 4
    -1: PROCEDURE | ADD_INFO : 4
    -1: PROCEDURE | P_MEMBERSHIP_DAILY_EVENTS : 47
    --2: PROCEDURE | P_SPRINT_TIMESHEET : 23
    --2: PROCEDURE | P_TIMESHEET : 29
    --2: PACKAGE BODY | PKG_DAILY_EVENTS.PROCESS : 135
    ---3: TRIGGER | TR_EMPLOYEE_AIUD : 4
    ---3: TRIGGER | TR_TEAM_MEMBER_AIUD : 4


## UPDATE_CALL_CHAIN

This procedure searches UPDATE command of the given table. Writes out the name of container procedure/function and then calls PROC_CALL_CHAIN to crawl the whole call tree.

    procedure UPDATE_CALL_CHAIN( I_TABLE_NAME      in varchar 
                               , I_OWNER           in varchar default null
                               ) 

## INSERT_CALL_CHAIN

Similar to UPDATE but for INSERT.


